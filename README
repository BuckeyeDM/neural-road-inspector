# Motivation
Devastating hurricanes are occurring with higher frequency due to global climate change.  After a hurricane, roads are often flooded or washed out, making them treacherous for motorists.

Using state of the art deep learning methods, I attempted to automatically annotate flooded, washed out, or otherwise severely damaged roads.  My goal is create a tool that can help detect and visualize anomalous roads in a simple user interface.

# Getting Started
## Prerequisites

In your shell, run:
> pip install -r requirements.txt

## Training Data

My model is trained purely with satellite imagery and street map images from [MapBox API](https://www.mapbox.com/api-documentation/) but this code will accept training images from other sources.
Because I do not own the training images, no training data is copied here.  You will have to sign up for a MapBox account to get an access token.

I chose to train images from zoom level 16 (Open Street Map Slippy Map Format).

## Training the Road Segmentation Neural Network Model

For an in-depth technical discussion of the model, please see:

> python RoadSegmentor.py [config file]

Before you can train the model, create a config file to point to your datasets and specify training hyper-parameters.  The config file contains paths to the training images and model training parameters.  See cfg/default.cfg for an example.

In your configuration file, specify the relative or absolute paths to your training data.  You must also supply a plaintext file listing satellite image files with column label 'img'.  See data/tile_log.csv for an example.

With a Nvidia Quadro P5000 GPU (16MB GPU RAM), training with a batch size of 16 took about 5 hours on a dataset with about 9000 images.

## Generating Road Segmentation Tiles

For road change detection, you will need to generate 2 sets of road segmentations: pre-hurricane and post-hurricane.

Post Hurricane satellite imagery (in GeoTiff format) can be downloaded via the DigitalGlobe Open Data Program.  For convenience, you can use data/tiffDownloader.py to download a set of geotiff files.  The script takes in a text file containing a list of http urls on separate lines.

In a data pre-processing step, [GDAL2Tiles](https://github.com/OSGeo/gdal) is used cut the GeoTiff files into TMS standard tiles at the same zoom level as the training set.

Command line tool:

> python roadSegmentationMaskGen.py [satellite_images_dir] [output_dir] [keras_model_filepath]

## Generating Annotated Map Tiles

After both the pre-hurricane segmentation tiles and post-hurricane segemntation tiles have been generated,  the next step is generating the difference.

This project comes with a command line tool that generate a pyramid hierarchy of annotated map tiles following the same hierarchy structure of the input directories.

> python postprocessing/anomalyMapGen.py [pre_event_segment_dir] [post_event_segment_dir] [street_map_dir] [output_dir]

### Demo

Embed here if possible!

### License
Code: MIT License

Road Segmentation Weight File: CC-BY-SA

Map Artifacts: CC-BY-SA

### Disclaimer
This project is for research purposes only.  Further testing and improvement is needed for real world use.
